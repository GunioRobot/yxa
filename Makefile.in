# $Id: Makefile.in 2758 2005-08-24 14:08:29Z ft $
#

srcdir = @srcdir@
top_srcdir = @top_srcdir@
VPATH = @srcdir@
prefix = @prefix@
DESTDIR = @DESTDIR@
SHELL = @SHELL@

confdir = @sysconfdir@
sslcertdir = @sslcertdir@
mnesiadir = @mnesiadir@
beamdir = @libdir@/yxa/ebin
includedir = @libdir@/yxa/include
sbindir = @sbindir@
exec_prefix=${prefix}
builddir = @builddir@
local_file = @local_file@

ERLC = @ERLC@
ERL = @ERL@

INSTALL = @INSTALL@
install_DATA = @INSTALL_DATA@
install_PROGRAM = @INSTALL_PROGRAM@

mkinstalldirs = $(SHELL) $(top_srcdir)/scripts/mkinstalldirs

SUBDIRS = \
	src \
	yaws/src

RECURSIVE_TARGETS = all-recursive install-recursive clean-recursive

all: all-recursive

$(RECURSIVE_TARGETS):
	@target=`echo $@ | sed s/-recursive//`; \
	list='$(SUBDIRS)'; for subdir in $$list; do \
	echo "Making $$target in $$subdir"; \
	(cd $$subdir && $(MAKE) $$target) || exit 1; \
	done

install: install-recursive
	$(mkinstalldirs) $(DESTDIR)$(confdir)
	$(mkinstalldirs) $(DESTDIR)$(sslcertdir)

clean: clean-recursive
	rm -f core *.core *~
	rm -f yxa-bootstrap.sh local.erl
	rm -f newversion.erl.new version.erl.in
	rm -f *.beam *.script *.start *.boot *.rel *.app *.script
	rm -f *.o ktrace.out erl_crash.dump

sslkey:
	@if [ -f $(DESTDIR)$(sslcertdir)/ssl.config ]; then \
		echo ""; \
		echo "You already have a $(DESTDIR)$(sslcertdir)/ssl.config file - "; \
		echo "aborting to not accidentally overwrite existing ssl keys"; \
		echo ""; \
		false; \
	    else \
		true; \
	fi
	$(mkinstalldirs) -m 700 $(DESTDIR)$(sslcertdir)
	cp $(srcdir)/ssl.config $(DESTDIR)$(sslcertdir)/ssl.config
	cd $(DESTDIR)$(sslcertdir) && openssl req -days 2002 -new -text -out cert.req -config ./ssl.config
	cd $(DESTDIR)$(sslcertdir) && openssl rsa -in privkey.pem -out cert.pem -passin pass:foobar
	cd $(DESTDIR)$(sslcertdir) && openssl req -days 2002 -x509 -in cert.req -text -key cert.pem -out cert.cert
	cat $(DESTDIR)$(sslcertdir)/cert.cert $(DESTDIR)$(sslcertdir)/cert.pem > $(DESTDIR)$(sslcertdir)/cert.comb

test:
	echo "Making test in src/"; \
	(cd src/ && $(MAKE) test) || exit 1

covertest:
	echo "Making covertest in src/"; \
	(cd src/ && $(MAKE) covertest) || exit 1
